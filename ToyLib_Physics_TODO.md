# ToyLib Physics TODO List

このドキュメントは、**現在の ToyLib 物理システムを前提に**
「今後やるとよさそうな改善・拡張」を整理した TODO 集です。

目的は以下の3点です：
- 実装の迷走を防ぐ
- ゲーム向けに“効く”改良を優先する
- エンジンを重くしすぎない

---

## 1. 安定性・正確性

### [ ] 斜面上の滑り制御（Slope Friction）
- 現状：斜面でも完全に停止できる
- 課題：急斜面で不自然
- 案：
  - `normal.y` に応じた疑似摩擦
  - 一定角度以上で下方向成分を付与

---

### [ ] 接地状態のヒステリシス
- 現状：hasGround がフレーム単位で揺れることがある
- 案：
  - N フレーム連続で ground → grounded
  - 落下も同様にディレイ

---

### [ ] 足OBBと胴体OBBの役割分離明確化
- FOOT：接地専用
- BODY：壁・天井・押し戻し
- 将来：段差・段乗りの判断を FOOT 側に集約

---

## 2. 壁・移動まわり

### [ ] Ray 本数・高さの設定をデータ化
- 今回の教訓：kRayLow は“地雷”になりやすい
- 案：
  - MoveComponent に Ray 設定 struct
  - キャラごとに調整可能

---

### [ ] Ray と OBB の責務明確化
- Ray：移動の予測・制限
- OBB：最後の保険（MTV）
- 原則：
  - OBB に頼らない設計を維持

---

## 3. デバッグ性

### [ ] Phys Debug Overlay
- 表示候補：
  - 接地 normal
  - Ray 可視化
  - MTV vector
- トグル可能に

---

### [ ] Ground 判定ログの定型化
- 今回のログは非常に有効だった
- 案：
  - `[Gravity][Ground] src= terrain/collider normal=...`
  - ログレベル切替

---

## 4. パフォーマンス

### [ ] Collider ペアの事前フィルタ
- 今は全探索寄り
- 案：
  - フラグ別配列
  - BroadPhase（簡易グリッド / Sweep & Prune）

---

### [ ] RayHitWall の高速化
- 現状：全 Collider
- 案：
  - WALL 専用リスト
  - BoundingSphere 先行判定

---

## 5. ゲーム向け拡張

### [ ] 動く床の正式サポート
- 現状：位置差分追従
- 将来：
  - 回転床
  - スケール床
  - Conveyor 的挙動

---

### [ ] 段差昇降の明示ルール
- 現状：暗黙的に成功している
- 案：
  - MaxStepUp / Down を使った明確判定
  - デバッグ表示

---

### [ ] 物理マテリアル（簡易）
- 摩擦 / 反発を enum 程度で
- 本格化しないのがポイント

---

## 6. 設計・思想メモ

- ToyLib は「万能物理」ではなく「ゲーム向け物理」
- 正確さより **気持ちよさ・調整しやすさ**
- Ray + OBB + Gravity の分離は維持
- 「床か壁か」はフラグより“文脈”で決める

---

## 最後に

今回の一連の修正で得られた最大の成果：

> **「床と壁を分けようとしすぎない」方が安定する**

これは ToyLib の設計哲学として、
ぜひこの TODO と一緒に残しておきたい知見です。
